# GRUB configuration file
# XyvorraOS Boot Menu

# Timeout for menu (in seconds)
set timeout=30
set timeout_style=menu

# Default boot entry (0 = first option)
set default=0

# Load required modules
insmod all_video
insmod gfxterm
insmod png
insmod jpeg
insmod font

# Set graphics mode
set gfxmode=auto
set gfxpayload=keep

# Terminal settings
terminal_input console
terminal_output gfxterm

# Set menu colors (Green Haze text on black, White on Byzantium for selection)
set menu_color_normal=light-green/black
set menu_color_highlight=white/magenta

# Load font
if loadfont unicode ; then
  set gfxmode=auto
  insmod gfxterm
fi

# Clear the screen
clear

# Display ASCII Art and Welcome Message
echo ""
echo "    ╦ ╦┬ ┬┬  ┬┌─┐┬─┐┬─┐┌─┐╔═╗╔═╗"
echo "   ╔╩╦╝└┬┘└┐┌┘│ │├┬┘├┬┘├─┤║ ║╚═╗"
echo "   ╩ ╚═ ┴  └┘ └─┘┴└─┴└─┴ ┴╚═╝╚═╝"
echo "   "
echo "    ═══════════════════════════════════════"
echo "         Welcome to XyvorraOS v1.0"
echo "    ═══════════════════════════════════════"
echo ""
echo "    Choose your boot option:"
echo ""
echo "    → Live USB Mode - Try without installing"
echo "    → Install Mode - Install to hard drive"
echo ""
echo "    Use ↑↓ arrows to select, Enter to boot"
echo ""

# Main Boot Menu Entries

menuentry "XyvorraOS - Live USB Mode" {
    set gfxpayload=keep
    linux /%INSTALL_DIR%/boot/x86_64/vmlinuz-linux archisobasedir=%INSTALL_DIR% archisolabel=%ARCHISO_LABEL% cow_spacesize=4G copytoram=n quiet splash loglevel=3 systemd.show_status=false rd.udev.log_level=3 vt.global_cursor_default=0 console=tty1
    initrd /%INSTALL_DIR%/boot/x86_64/initramfs-linux.img
}

menuentry "XyvorraOS - Install to Hard Drive" --class xyvorra --class gnu-linux --class gnu --class os {
    set gfxpayload=keep
    linux /%INSTALL_DIR%/boot/x86_64/vmlinuz-linux archisobasedir=%INSTALL_DIR% archisolabel=%ARCHISO_LABEL% cow_spacesize=4G xyvorra_install=yes copytoram=n quiet splash loglevel=3 udev.log_level=3 vt.global_cursor_default=0
    initrd /%INSTALL_DIR%/boot/x86_64/initramfs-linux.img
}

menuentry "XyvorraOS - Safe Graphics Mode" --class xyvorra --class gnu-linux --class gnu --class os {
    set gfxpayload=keep
    linux /%INSTALL_DIR%/boot/x86_64/vmlinuz-linux archisobasedir=%INSTALL_DIR% archisolabel=%ARCHISO_LABEL% cow_spacesize=4G nomodeset copytoram=n
    initrd /%INSTALL_DIR%/boot/x86_64/initramfs-linux.img
}

# Submenu for Advanced Options
submenu 'Advanced Options' --class advanced {
    
    menuentry "XyvorraOS - Live USB (with Logs)" --class xyvorra {
        set gfxpayload=keep
        linux /%INSTALL_DIR%/boot/x86_64/vmlinuz-linux archisobasedir=%INSTALL_DIR% archisolabel=%ARCHISO_LABEL% cow_spacesize=4G copytoram=n
        initrd /%INSTALL_DIR%/boot/x86_64/initramfs-linux.img
    }
    
    menuentry "XyvorraOS - Copy to RAM" --class xyvorra {
        set gfxpayload=keep
        linux /%INSTALL_DIR%/boot/x86_64/vmlinuz-linux archisobasedir=%INSTALL_DIR% archisolabel=%ARCHISO_LABEL% cow_spacesize=4G copytoram=y quiet splash
        initrd /%INSTALL_DIR%/boot/x86_64/initramfs-linux.img
    }
    
    menuentry "XyvorraOS - Basic Graphics (VESA)" --class xyvorra {
        set gfxpayload=keep
        linux /%INSTALL_DIR%/boot/x86_64/vmlinuz-linux archisobasedir=%INSTALL_DIR% archisolabel=%ARCHISO_LABEL% cow_spacesize=4G nomodeset xdriver=vesa copytoram=n
        initrd /%INSTALL_DIR%/boot/x86_64/initramfs-linux.img
    }
    
    menuentry "Boot existing OS (if present)" --class os {
        insmod part_gpt
        insmod part_msdos
        insmod chain
        set root=(hd0,1)
        chainloader +1
    }
}

# Utility Options
menuentry "System Information" --class info {
    insmod gfxterm
    clear
    echo "XyvorraOS System Information"
    echo "============================"
    echo ""
    echo "Version: 1.0"
    echo "Based on: Arch Linux"
    echo "Kernel: Linux"
    echo "Desktop: KDE Plasma"
    echo ""
    echo "Press ESC to return to menu"
    sleep --interruptible 30
}

menuentry "Reboot" --class reboot {
    echo "Rebooting system..."
    reboot
}

menuentry "Power Off" --class shutdown {
    echo "Shutting down..."
    halt
}
